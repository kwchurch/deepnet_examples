
x = read.table("wikitext-103-raw-v1.test.unmasked.forR", header=T)

pdf("calibration.pdf")
par(ps=16)
plot(seq(0,1,0.01), sapply(split(x$correct, round(x$score, 2)), mean), xlab="score", ylab="Pr(correct)")
abline(0,1, lwd=3, lty=3, col="red")
dev.off()

g = glm(correct ~ score + log(1+freq), data=x, family=binomial)

summary(g)

# Call:
# glm(formula = correct ~ score + log(1 + freq), family = binomial, 
#     data = x)

# Deviance Residuals: 
#     Min       1Q   Median       3Q      Max  
# -2.4809  -0.5538   0.3434   0.5799   2.7394  

# Coefficients:
#                Estimate Std. Error z value Pr(>|z|)    
# (Intercept)   -4.913398   0.023072  -213.0   <2e-16 ***
# score          4.351443   0.021521   202.2   <2e-16 ***
# log(1 + freq)  0.229129   0.001938   118.2   <2e-16 ***
# ---
# Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

# (Dispersion parameter for binomial family taken to be 1)

#     Null deviance: 314944  on 237846  degrees of freedom
# Residual deviance: 196284  on 237844  degrees of freedom
# AIC: 196290

# Number of Fisher Scoring iterations: 5

anova(g)
# Analysis of Deviance Table

# Model: binomial, link: logit

# Response: correct

# Terms added sequentially (first to last)


#               Df Deviance Resid. Df Resid. Dev
# NULL                         237846     314944
# score          1   103517    237845     211427
# log(1 + freq)  1    15143    237844     196284

